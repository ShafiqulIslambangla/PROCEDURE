CREATE OR REPLACE PROCEDURE SKS.INV_DATA_PROCESS (P_COMPANY_CODE VARCHAR2, P_COMPANY_BRANCH_CODE VARCHAR2,P_DEPT_CODE VARCHAR2,P_STORE_CODE VARCHAR2,P_VR_DATE DATE, P_VR_NO VARCHAR2) AS
    P_MNYR  VARCHAR2(7);
    P_MNYR_FROM VARCHAR2(7);
 BEGIN
                           
   DECLARE
   CURSOR C1 IS
      SELECT A.COMPANY_CODE, A.COMPANY_BRANCH_CODE, A.FINANCE_CODE, A.PROJECT_CODE, A.COMPONENT_CODE,         
      A.DEPT_CODE, A.STORE_CODE, 'GRN', 'R', A.RCV_NO, A.RCV_DT, A.L1_CODE, A.L2_CODE, A.L3_CODE, A.L4_CODE, A.L5_CODE, A.SL, A.RCV_QTY,
      A.POSTING_FLAG, R.SUPPLIER_CODE,R.INS_DATE,R.INS_USER,R.UPD_DATE,R.UPD_USER,'P'
      FROM INV_RCV_DTL A, INV_RCV R
      WHERE
      A.COMPANY_CODE        =R.COMPANY_CODE AND
      A.COMPANY_BRANCH_CODE =R.COMPANY_BRANCH_CODE AND
      A.FINANCE_CODE        =R.FINANCE_CODE AND
      A.PROJECT_CODE        =R.PROJECT_CODE AND
      A.COMPONENT_CODE      =R.COMPONENT_CODE AND
      A.DEPT_CODE           =R.DEPT_CODE AND
      A.STORE_CODE           =R.STORE_CODE AND
      A.RCV_NO              =R.RCV_NO AND
      A.RCV_DT              =R.RCV_DT AND
      A.RCV_NO              =P_VR_NO AND
      A.RCV_DT              =P_VR_DATE;
        BEGIN
            FOR REC IN C1 LOOP
              INSERT INTO INV_POSTED_TRANSACTION(COMPANY_CODE, COMPANY_BRANCH_CODE, FINANCE_CODE, PROJECT_CODE, COMPONENT_CODE, DEPT_CODE,STORE_CODE, 
              TR_TYPE, TR_CODE, POSTING_FLAG, VR_NO, VR_DATE, L1_CODE, L2_CODE, L3_CODE, L4_CODE, L5_CODE,SL,RCV_QTY)
              VALUES(P_COMPANY_CODE,P_COMPANY_BRANCH_CODE,REC.FINANCE_CODE,REC.PROJECT_CODE,REC.COMPONENT_CODE,P_DEPT_CODE,P_STORE_CODE,
              'R', 'GRN', REC.POSTING_FLAG, P_VR_NO, P_VR_DATE, REC.L1_CODE, REC.L2_CODE, REC.L3_CODE, REC.L4_CODE, REC.L5_CODE, REC.SL,REC.RCV_QTY);
        END LOOP;
              COMMIT;
    END;
END INV_DATA_PROCESS;
/
